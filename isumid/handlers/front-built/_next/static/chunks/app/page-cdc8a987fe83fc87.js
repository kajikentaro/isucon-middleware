(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{245:function(e,t,s){Promise.resolve().then(s.bind(s,4166))},4166:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return eg}});var n=s(7437),a=s(9686);let r=(0,a.oM)({name:"executionProgress",initialState:{},reducers:{setExecutionProgressAll:(e,t)=>t.payload,setExecutionProgress:(e,t)=>({...e,[t.payload.ulid]:t.payload.executionProgress})},selectors:{selectExecutionProgressMap:e=>e}}),o=r.reducer,{selectExecutionProgressMap:c}=r.selectors,i=e=>t=>c(t)[e],{setExecutionProgress:l,setExecutionProgressAll:d}=r.actions,u=(0,a.oM)({name:"executionResponse",initialState:{},reducers:{setExecutionResponse:(e,t)=>({...e,[t.payload.ulid]:t.payload.executeResponse})},selectors:{selectExecutionResponseMap:e=>e}}),x=u.reducer,{selectExecutionResponseMap:h}=u.selectors,p=e=>t=>h(t)[e],{setExecutionResponse:m}=u.actions;function f(e){return async(t,s)=>{try{t(l({ulid:e,executionProgress:"waitingResponse"}));let s=await fetch("".concat("/","isumid/reproduce/").concat(e)),n=await s.json();if(t(m({ulid:e,executeResponse:n})),!n.isSameStatusCode){t(l({ulid:e,executionProgress:"statusCodeNotSame"}));return}if(!n.isSameResBody){t(l({ulid:e,executionProgress:"bodyNotSame"}));return}if(!n.isSameResHeader){t(l({ulid:e,executionProgress:"headerNotSame"}));return}t(l({ulid:e,executionProgress:"success"}))}catch(s){t(l({ulid:e,executionProgress:"fail"}))}}}var j=s(3046),b=s(8742);let g=(0,a.oM)({name:"recordedTransaction",initialState:{},reducers:{setRecordedTransactionList:(e,t)=>{let s={};for(let e of t.payload)s[e.ulid]=e;return s}},selectors:{selectRecordedTransactionMap:e=>e}}),y=g.reducer,{selectRecordedTransactionMap:w}=g.selectors,N=e=>t=>w(t)[e],v=(0,b.P1)([w],e=>Object.keys(e)),{setRecordedTransactionList:k}=g.actions,R=(0,a.oM)({name:"totalTransactions",initialState:-1,reducers:{setTotalTransactions:(e,t)=>t.payload},selectors:{selectTotalTransactions:e=>e}}),S=R.reducer,{selectTotalTransactions:C}=R.selectors,{setTotalTransactions:P}=R.actions,T={isVisible:!1,ulid:""},E=(0,a.oM)({name:"comparisonPopup",initialState:T,reducers:{showComparisonPopup:(e,t)=>({isVisible:!0,ulid:t.payload}),closeComparisonPopup:(e,t)=>T},selectors:{selectComparisonPopup:e=>e}}),{selectComparisonPopup:L}=E.getSelectors(e=>e.ui.comparisonPopup),{showComparisonPopup:M,closeComparisonPopup:B}=E.actions,q=(0,a.oM)({name:"isFetchingTransactions",initialState:!0,reducers:{setIsFetchingTransactions:(e,t)=>t.payload},selectors:{selectIsFetchingTransactions:e=>e}}),{selectIsFetchingTransactions:F}=q.getSelectors(e=>e.ui.isFetchingTransactions),{setIsFetchingTransactions:O}=q.actions,_=(0,a.oM)({name:"selectedUlids",initialState:[],reducers:{setSelectedUlids:(e,t)=>t.payload},selectors:{selectSelectedUlids:e=>e}}),{selectSelectedUlids:A}=_.getSelectors(e=>e.ui.selectedUlids),{setSelectedUlids:H}=_.actions,I=(0,a.Ku)(_,q,E),K=(0,a.xC)({reducer:{executionProgress:o,recordedTransaction:y,executionResponse:x,totalTransactions:S,ui:I}}),z=j.I0,U=j.v9;function Q(e){let t=z(),s=U(N(e));if(!s)throw Error("ulid (".concat(e,") is not found"));return()=>{t(async(t,s)=>{let n=i(e)(s());"waitingQueue"!==n&&"waitingResponse"!==n&&t(f(e))})}}function V(){return(0,n.jsx)("span",{className:"border border-gray-300 text-xs py-1 px-2 text-gray-500 rounded-full block w-fit",children:"empty"})}function G(e){let{children:t,isInline:s}=e;return t?s?(0,n.jsx)("code",{className:"bg-gray-700 text-white p-1 text-xs",children:t}):(0,n.jsx)("code",{className:"block bg-black text-white p-2 rounded-md my-2 whitespace-pre-line break-all",children:t}):(0,n.jsx)(V,{})}var D=s(1396),J=s.n(D);function W(e){let{type:t,ulid:s,className:a,contentLength:r}=e;return 0===r?(0,n.jsx)(V,{}):(0,n.jsx)(J(),{href:"/".concat(t,"/").concat(s),onClick:e=>{e.stopPropagation()},className:"inline-flex ".concat(a||""),prefetch:!1,children:(0,n.jsxs)("span",{className:"bg-green-500 text-white py-1 px-2 text-xs rounded-full block w-fit",children:["binary data ",r?function(e){let t=Number(e)/1024,s=t/1024,n=s/1024,a=n/1024;return a>=1?a.toFixed(2)+" TB":n>=1?n.toFixed(2)+" GB":s>=1?s.toFixed(2)+" MB":t>=1?t.toFixed(2)+" KB":e+" Bytes"}(r):""]})})}function X(e){return Object.entries(e).map(e=>{let[t,s]=e;return"".concat(t,": ").concat(s.join(", "))}).join("\n")}var Y=s(2265);function Z(){let e=U(L);return e.isVisible?(0,n.jsx)($,{}):null}function $(){let e=z();(0,Y.useEffect)(()=>(window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}),[]);let t=()=>{e(B())},s=e=>{"Escape"===e.key&&t()};return(0,n.jsx)("div",{className:"fixed z-50 top-0 left-0 w-full h-full flex justify-center items-center bg-black bg-opacity-50 px-10 py-20",onClick:t,children:(0,n.jsxs)("div",{className:"bg-white p-6 rounded-md w-full h-full overflow-y-auto",onClick:e=>{e.stopPropagation()},children:[(0,n.jsx)("button",{onClick:t,className:"absolute top-30 right-20 text-gray-800 text-xl w-12 h-12 bg-slate-200 hover:opacity-80 rounded-full",children:"X"}),(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Comparison"}),(0,n.jsx)(ee,{})]})})}function ee(){let e=U(L),t=U(N(e.ulid)),s=U(p(e.ulid)),a=Q(e.ulid);return(0,n.jsxs)("div",{children:[(0,n.jsx)(Request,{statusCode:t.statusCode,ulid:e.ulid,body:t.reqBody,header:t.reqHeader,isText:t.isReqText,contentLength:t.reqLength}),(0,n.jsx)("span",{className:"mb-4 h-0.5 bg-gray-300 block"}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsxs)("div",{className:"w-full flex",children:[(0,n.jsx)(Response,{transaction:{statusCode:t.statusCode,ulid:e.ulid,body:t.resBody,header:t.resHeader,isText:t.isResText,contentLength:t.resLength},type:"res-body",title:"Recorded Response"}),(0,n.jsx)("span",{className:"w-0.5 bg-gray-300"}),s?(0,n.jsx)(Response,{transaction:{statusCode:s.statusCode,ulid:e.ulid,body:s.actualResBody,header:s.actualResHeader,isText:s.isBodyText,contentLength:s.actualResLength},type:"reproduced-res-body",title:"Actual Response"}):(0,n.jsxs)("div",{className:"w-1/2 p-4 rounded-md mb-4",children:[(0,n.jsx)("p",{children:"This transaction have not been executed yet"}),(0,n.jsx)("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-2 rounded-full mt-10 m-auto block",onClick:e=>{e.stopPropagation(),a()},children:"Execute"})]})]})})]})}function Request(e){let{header:t,isText:s,body:a,ulid:r,contentLength:o}=e;return(0,n.jsxs)("div",{className:"p-4 rounded-md",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold my-2"}),(0,n.jsx)("p",{children:"Request Header:"}),(0,n.jsx)(G,{children:X(t)}),(0,n.jsx)("p",{children:"Request Body:"}),s?(0,n.jsx)(G,{children:a}):(0,n.jsx)(W,{ulid:r,type:"req-body",className:"mt-2",contentLength:o})]})}function Response(e){let{type:t,title:s,transaction:{header:a,statusCode:r,isText:o,body:c,ulid:i,contentLength:l}}=e;return(0,n.jsxs)("div",{className:"w-1/2 p-4 rounded-md mb-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold my-2",children:s}),(0,n.jsx)("p",{children:"Response Header:"}),(0,n.jsx)(G,{children:X(a)}),(0,n.jsx)("p",{children:"Status Code:"}),(0,n.jsx)(G,{children:r}),(0,n.jsx)("p",{children:"Response Body:"}),o?(0,n.jsx)(G,{children:c}):(0,n.jsx)(W,{ulid:i,type:t,className:"mt-2",contentLength:l})]})}var et=s(4033);function es(){let e=(0,et.useSearchParams)(),t=(0,Y.useMemo)(()=>{let t=e.get("page")||"1",s=Number(t);return isNaN(s)?1:s},[e]);return t}function en(){let e=z(),t=U(F),s=async t=>{let s=await fetch("".concat("/","isumid/list?offset=").concat((t-1)*100,"&length=").concat(100)),n=await s.json();e(k(n));let a={};for(let e of n)a[e.ulid]="init";e(d(a)),e(H(Object.keys(a))),e(O(!1))};return{fetchTransactions:s,isFetchingTransactions:t}}function ea(){let e=z(),t=U(C),s=async()=>{e(P(-1));let t=await fetch("".concat("/","isumid/total-transactions")),s=await t.json(),n=s.count;e(P(n))};return{fetchTotalTransactions:s,totalTransactions:t}}function er(){let e=function(){let e=z(),t=U(A);return()=>{e(async(e,s)=>{let n={...c(s())};for(let e of t)"waitingResponse"!==n[e]&&(n[e]="waitingQueue");for(let a of(e(d(n)),t)){let t=i(a)(s());"waitingQueue"===t&&await e(f(a))}})}}();return(0,n.jsx)("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded-full flex items-center",onClick:t=>{e(),t.stopPropagation()},children:"Execute Checked"})}function eo(){let{isFetchingTransactions:e}=en(),{totalTransactions:t}=ea(),s=Math.ceil(t/100),{fetchTransactions:a}=en(),r=es(),o=e=>({href:{query:{page:e}},onClick:()=>a(e)}),c=e=>2>=Math.abs(e-r)||1===e||e===s;return e||s<=1?null:(0,n.jsx)("nav",{className:"my-4",children:(0,n.jsxs)("ul",{className:"flex items-center gap-3 bg-gray-200 rounded-full px-3",children:[r>1&&(0,n.jsx)("li",{className:"flex",children:(0,n.jsx)(J(),{...o(r-1),prefetch:!1,className:"font-bold py-2 px-3 rounded-lg",children:"<"})}),Array.from({length:s},(e,t)=>t+1).map(e=>c(e)?e===r?(0,n.jsx)("li",{className:"text-white w-8 h-7 rounded-full bg-slate-500 flex items-center justify-center",children:(0,n.jsx)("span",{children:e})},e):(0,n.jsx)("li",{className:"flex",children:(0,n.jsx)(J(),{...o(e),prefetch:!1,className:"font-bold py-2 px-3 rounded-lg",children:e})},e):2===e||e===s-1?(0,n.jsx)("li",{className:"flex",children:(0,n.jsx)("span",{children:"..."})},e):null),r<s&&(0,n.jsx)("li",{className:"flex",children:(0,n.jsx)(J(),{...o(r+1),prefetch:!1,className:"font-bold py-2 px-3 rounded-lg",children:">"})})]})})}var ec=s(7267);function ei(){let[e,t]=(0,Y.useState)(!1),{fetchTransactions:s}=en(),{fetchTotalTransactions:a}=ea(),r=es(),o="border py-1 px-2 rounded flex items-center w-36 justify-center gap-1 text-red-500 border-red-500",c=async()=>{let e=confirm("Are you sure you want to proceed with removal?");if(!e)return;t(!0);let n=await fetch("".concat("/","isumid/remove-all"),{method:"POST"});t(!1),200===n.status&&(await s(r),await a())};return e?(0,n.jsx)("button",{className:o,disabled:!0,children:"Removing. . ."}):(0,n.jsxs)("button",{className:o,onClick:c,children:[(0,n.jsx)(ec.v_0,{}),"Remove All"]})}function el(){let[e,t]=(0,Y.useState)(!1),{fetchTransactions:s}=en(),{fetchTotalTransactions:a}=ea(),r=es(),o=U(A),c="border py-1 px-2 rounded flex items-center w-44 justify-center gap-1 text-red-500 border-red-500",i=async()=>{let e=confirm("Are you sure you want to proceed with removal?");if(e){for(let e of(t(!0),o))await fetch("".concat("/","isumid/remove/").concat(e),{method:"POST"});t(!1),await s(r),await a()}};return e?(0,n.jsx)("button",{className:c,disabled:!0,children:"Removing. . ."}):(0,n.jsxs)("button",{className:c,onClick:i,children:[(0,n.jsx)(ec.v_0,{}),"Remove Selected"]})}var ed=s(3159);function eu(){let{recordingStatus:e,startRecording:t,stopRecording:s}=function(){let[e,t]=(0,Y.useState)("checking-status"),s=async()=>{let e=await fetch("".concat("/","isumid/is-recording")),s=await e.json();t(s.isRecording?"recording":"not-recording")},n=async()=>{t("checking-status"),await fetch("".concat("/","isumid/start-recording"),{method:"POST"}),setTimeout(s,1e3)},a=async()=>{t("checking-status"),await fetch("".concat("/","isumid/stop-recording"),{method:"POST"}),setTimeout(s,1e3)};return(0,Y.useEffect)(()=>{s()},[]),{recordingStatus:e,startRecording:n,stopRecording:a}}(),a="border-2 py-1 px-2 rounded-full flex items-center w-44 justify-center gap-1";return"checking-status"===e?(0,n.jsx)("button",{className:a,disabled:!0,children:"Now Loading ..."}):"recording"===e?(0,n.jsxs)("button",{className:a+" border-red-500 text-red-500",onClick:s,children:[(0,n.jsx)(ed.JuG,{}),"Stop Recording"]}):"not-recording"===e?(0,n.jsxs)("button",{className:a+" border-blue-500 text-blue-500 font-bold",onClick:t,children:[(0,n.jsx)(ed.gmG,{}),"Start Recording"]}):void 0}function ex(){return(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-1",children:[(0,n.jsx)("div",{className:"w-1 h-1 bg-black rounded-full animate-bounce"}),(0,n.jsx)("div",{className:"w-1 h-1 bg-black rounded-full animate-bounce"}),(0,n.jsx)("div",{className:"w-1 h-1 bg-black rounded-full animate-bounce"})]})}var eh=s(9150);function ep(e){let t=U(c)[e.ulid]||"fail",s={size:"25"},a=(0,n.jsx)(n.Fragment,{}),r="";switch(t){case"statusCodeNotSame":a=(0,n.jsx)(eh.SR5,{...s,color:"red"}),r="Status code doesn't match";break;case"bodyNotSame":a=(0,n.jsx)(eh.KP3,{...s,color:"red"}),r="Response body doesn't match";break;case"headerNotSame":a=(0,n.jsx)(eh.KP3,{...s,color:"orange"}),r="Headers don't match";break;case"waitingResponse":a=(0,n.jsx)(eh.xz6,{...s,className:"animate-spin"});break;case"fail":a=(0,n.jsx)(eh.SV5,{...s}),r="Request failed";break;case"success":a=(0,n.jsx)(eh.KP3,{...s,color:"green"});break;case"waitingQueue":a=(0,n.jsx)(ex,{...s});break;case"init":return(0,n.jsx)(n.Fragment,{})}return(0,n.jsxs)("div",{className:"relative inline-flex align-middle text-center",children:[a,r&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"opacity-0 pointer-events-none absolute z-10 bg-black text-white text-xs py-1 px-2 rounded whitespace-nowrap top-full -left-1/2 transform -translate-x-1/2 transition-opacity duration-300",children:r}),(0,n.jsx)("style",{children:"\n          .relative:hover .absolute {\n            opacity: 1;\n          }\n          "})]})]})}function em(e){let{onCheckboxClick:t,isSelected:s,ulid:a}=e,r=U(N(a)),o=Q(r.ulid),c=function(e){let t=z();return()=>{t(M(e))}}(r.ulid);return(0,n.jsxs)("tr",{className:"border-b hover:bg-gray-100",onClick:c,children:[(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",onClick:t,children:(0,n.jsx)("div",{className:"w-3 h-3 border  rounded m-auto block ".concat(s?"bg-blue-500 border-blue-500":" border-gray-500")})}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:r.method}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap max-w-lg overflow-hidden",children:r.url}),(0,n.jsx)("td",{className:"px-4 whitespace-nowrap overflow-hidden max-w-0",children:r.isReqText?(0,n.jsx)(G,{isInline:!0,children:r.reqBody}):(0,n.jsx)(W,{ulid:a,type:"req-body",contentLength:r.reqLength})}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:r.statusCode.toString()}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap overflow-hidden max-w-0",children:r.isResText?(0,n.jsx)(G,{isInline:!0,children:r.resBody}):(0,n.jsx)(W,{ulid:a,type:"res-body",contentLength:r.resLength})}),(0,n.jsx)("td",{className:"px-4 whitespace-nowrap text-center",children:(0,n.jsx)(ep,{ulid:r.ulid})}),(0,n.jsx)("td",{className:"px-4 whitespace-nowrap",children:(0,n.jsx)("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-2 rounded-full flex items-center m-auto",onClick:e=>{e.stopPropagation(),o()},children:(0,n.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l8 8-8 8"})})})})]})}function ef(){let e=z(),t=U(A),s=U(v),a=t.length===s.length;return(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"border-b bg-gray-100 text-gray-600",children:[(0,n.jsx)("th",{className:"px-4 py-2 whitespace-nowrap",onClick:()=>{a?e(H([])):e(H(s))},children:(0,n.jsx)("div",{className:"w-4 h-4 border border-gray-500 rounded m-auto block ".concat(a?"bg-blue-500":"bg-white")})}),(0,n.jsx)("th",{className:"px-4 py-2 whitespace-nowrap",children:"Method"}),(0,n.jsx)("th",{className:"px-4 py-2 whitespace-nowrap",children:"URL"}),(0,n.jsx)("th",{className:"px-4 py-2 w-1/2",children:"ReqBody"}),(0,n.jsx)("th",{className:"px-4 py-2",children:"Status Code"}),(0,n.jsx)("th",{className:"px-4 py-2 w-1/2",children:"ResBody"}),(0,n.jsx)("th",{children:"Execution Result"}),(0,n.jsx)("th",{className:"px-4 py-2 w-1/2",children:"Execute"})]})})}function ej(){let{isFetchingTransactions:e}=en(),t=U(A),s=z(),a=U(v),[r,o]=(0,Y.useState)(-1),c=(e,n,c)=>{let i=!t.includes(c),l=new Set(t);if(e.shiftKey)for(let e=Math.min(r,n);e<=Math.max(r,n);e++)i?l.add(a[e]):l.delete(a[e]);else i?l.add(c):l.delete(c);s(H(Array.from(l))),o(n),e.preventDefault(),e.stopPropagation()};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("table",{className:"table-auto border-collapse w-full",children:[(0,n.jsx)(ef,{}),(0,n.jsx)("tbody",{children:a.map((e,s)=>(0,n.jsx)(em,{isSelected:t.includes(e),onCheckboxClick:t=>c(t,s,e),ulid:e},e))})]}),e&&(0,n.jsx)("p",{children:"now loading"}),!e&&0===a.length&&(0,n.jsx)("p",{children:"result was not found"})]})}function eb(){let{fetchTransactions:e}=en(),{fetchTotalTransactions:t}=ea(),s=es();return(0,Y.useEffect)(()=>{e(s),t()},[s]),(0,n.jsxs)("div",{className:"flex flex-col justify-center items-center",children:[(0,n.jsxs)("div",{className:"flex w-full justify-between px-4 py-3 mb-2",children:[(0,n.jsx)(J(),{href:"/index.html",children:(0,n.jsx)("h1",{className:"text-3xl font-bold",children:"Isucon Middleware"})}),(0,n.jsxs)("div",{className:"flex gap-x-5",children:[(0,n.jsx)(el,{}),(0,n.jsx)(ei,{}),(0,n.jsx)(eu,{}),(0,n.jsx)(er,{})]})]}),(0,n.jsx)(ej,{}),(0,n.jsx)(eo,{})]})}function eg(){return(0,n.jsxs)(j.zt,{store:K,children:[(0,n.jsx)(eb,{}),(0,n.jsx)(Z,{})]})}}},function(e){e.O(0,[420,104,712,81,971,472,744],function(){return e(e.s=245)}),_N_E=e.O()}]);