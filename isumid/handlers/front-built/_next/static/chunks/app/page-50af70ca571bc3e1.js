(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{245:function(e,t,s){Promise.resolve().then(s.bind(s,5090))},5090:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return G}});var a=s(7437),n=s(9686);let o=(0,n.oM)({name:"executionProgress",initialState:{},reducers:{setExecutionProgressAll:(e,t)=>t.payload,setExecutionProgress:(e,t)=>({...e,[t.payload.ulid]:t.payload.executionProgress})},selectors:{selectExecutionProgressMap:e=>e}}),r=o.reducer,{selectExecutionProgressMap:l}=o.selectors,c=e=>t=>l(t)[e],{setExecutionProgress:i,setExecutionProgressAll:d}=o.actions,u=(0,n.oM)({name:"executionResponse",initialState:{},reducers:{setExecutionResponse:(e,t)=>({...e,[t.payload.ulid]:t.payload.executeResponse})},selectors:{selectExecutionResponseMap:e=>e}}),x=u.reducer,{selectExecutionResponseMap:p}=u.selectors,h=e=>t=>p(t)[e],{setExecutionResponse:m}=u.actions;function b(e){return async(t,s)=>{try{t(i({ulid:e,executionProgress:"waitingResponse"}));let s=await fetch("".concat("/","reproduce/").concat(e)),a=await s.json();if(t(m({ulid:e,executeResponse:a})),!a.IsSameStatusCode){t(i({ulid:e,executionProgress:"statusCodeNotSame"}));return}if(!a.IsSameResBody){t(i({ulid:e,executionProgress:"bodyNotSame"}));return}if(!a.IsSameResHeader){t(i({ulid:e,executionProgress:"headerNotSame"}));return}t(i({ulid:e,executionProgress:"success"}))}catch(s){t(i({ulid:e,executionProgress:"fail"}))}}}var f=s(3046),j=s(8742);let y=(0,n.oM)({name:"recordedTransaction",initialState:{},reducers:{setRecordedTransactionList:(e,t)=>{let s={};for(let e of t.payload)s[e.Ulid]=e;return s}},selectors:{selectRecordedTransactionMap:e=>e}}),g=y.reducer,{selectRecordedTransactionMap:w}=y.selectors,N=e=>t=>w(t)[e],k=(0,j.P1)([w],e=>Object.keys(e)),{setRecordedTransactionList:v}=y.actions,R={isVisible:!1,ulid:""},C=(0,n.oM)({name:"comparisonPopup",initialState:R,reducers:{showComparisonPopup:(e,t)=>({isVisible:!0,ulid:t.payload}),closeComparisonPopup:(e,t)=>R},selectors:{selectComparisonPopup:e=>e}}),P=C.reducer,{selectComparisonPopup:S}=C.selectors,{showComparisonPopup:B,closeComparisonPopup:E}=C.actions,M=(0,n.xC)({reducer:{executionProgress:r,recordedTransaction:g,executionResponse:x,comparisonPopup:P}}),T=f.I0,q=f.v9;function L(e){let t=T(),s=q(N(e));if(!s)throw Error("ulid (".concat(e,") is not found"));return()=>{t(async(t,s)=>{let a=c(e)(s());"waitingQueue"!==a&&"waitingResponse"!==a&&t(b(e))})}}var I=s(1396),H=s.n(I);function A(e){let{type:t,ulid:s,className:n,contentLength:o}=e;return(0,a.jsx)(H(),{href:"".concat("/").concat(t,"/").concat(s),onClick:e=>{e.stopPropagation()},className:"inline-flex ".concat(n||""),children:(0,a.jsxs)("span",{className:"bg-green-500 text-white py-1 px-2 text-xs rounded-full block w-fit",children:["binary data ",function(e){let t="";if(!e)return"";if(Array.isArray(e)){if(0===e.length)return"";t=e[0]}else t=e;let s=Number(t)/1024,a=s/1024,n=a/1024,o=n/1024;return o>=1?o.toFixed(2)+" TB":n>=1?n.toFixed(2)+" GB":a>=1?a.toFixed(2)+" MB":s>=1?s.toFixed(2)+" KB":t+" Bytes"}(o)]})})}function F(e){return Object.entries(e).map(e=>{let[t,s]=e;return"".concat(t,": ").concat(s.join(", "))}).join("\n")}function U(){let e=q(S),t=T();if(!e.isVisible)return null;let s=()=>{t(E())};return(0,a.jsx)("div",{className:"fixed z-50 top-0 left-0 w-full h-full flex justify-center items-center bg-black bg-opacity-50 px-10 py-20",onClick:s,children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-md w-full h-full overflow-y-auto",onClick:e=>{e.stopPropagation()},children:[(0,a.jsx)("button",{onClick:s,className:"absolute top-30 right-20 text-gray-800 text-xl w-12 h-12 bg-slate-200 hover:opacity-80 rounded-full",children:"X"}),(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Comparison"}),(0,a.jsx)(_,{})]})})}function _(){let e=q(S),t=q(N(e.ulid)),s=q(h(e.ulid)),n=L(e.ulid);return(0,a.jsxs)("div",{children:[(0,a.jsx)(Request,{statusCode:t.StatusCode,ulid:e.ulid,body:t.ReqBody,header:t.ReqHeader,isText:t.IsReqText}),(0,a.jsx)("span",{className:"mb-4 h-0.5 bg-gray-300 block"}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)("div",{className:"w-full flex",children:[(0,a.jsx)(Response,{transaction:{statusCode:t.StatusCode,ulid:e.ulid,body:t.ResBody,header:t.ResHeader,isText:t.IsResText},type:"res-body",title:"Recorded Response"}),(0,a.jsx)("span",{className:"w-0.5 bg-gray-300"}),s?(0,a.jsx)(Response,{transaction:{statusCode:s.StatusCode,ulid:e.ulid,body:s.ActualResBody,header:s.ActualResHeader,isText:s.IsBodyText},type:"reproduced-res-body",title:"Actual Response"}):(0,a.jsxs)("div",{className:"w-1/2 p-4 rounded-md mb-4",children:[(0,a.jsx)("p",{children:"This transaction have not been executed yet"}),(0,a.jsx)("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-2 rounded-full mt-10 m-auto block",onClick:e=>{e.stopPropagation(),n()},children:"Execute"})]})]})})]})}function Request(e){let{header:t,isText:s,body:n,ulid:o}=e;return(0,a.jsxs)("div",{className:"p-4 rounded-md",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold my-2"}),(0,a.jsx)("p",{children:"Request Header:"}),(0,a.jsx)("code",{className:"block bg-black text-white p-2 rounded-md my-2 whitespace-pre-line",children:F(t)}),(0,a.jsx)("p",{children:"Request Body:"}),s?(0,a.jsx)("code",{className:"block bg-black text-white p-2 rounded-md my-2 whitespace-pre-line",children:n}):(0,a.jsx)(A,{ulid:o,type:"req-body",className:"mt-2",contentLength:t["Content-Length"]})]})}function Response(e){let{type:t,title:s,transaction:{header:n,statusCode:o,isText:r,body:l,ulid:c}}=e;return(0,a.jsxs)("div",{className:"w-1/2 p-4 rounded-md mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold my-2",children:s}),(0,a.jsx)("p",{children:"Response Header:"}),(0,a.jsx)("code",{className:"block bg-black text-white p-2 rounded-md my-2 whitespace-pre-line",children:F(n)}),(0,a.jsx)("p",{children:"Status Code:"}),(0,a.jsx)("code",{className:"block bg-black text-white p-2 rounded-md my-2",children:o}),(0,a.jsx)("p",{children:"Response Body:"}),r?(0,a.jsx)("code",{className:"block bg-black text-white p-2 rounded-md my-2 whitespace-pre-line",children:l}):(0,a.jsx)(A,{ulid:c,type:t,className:"mt-2",contentLength:n["Content-Length"]})]})}function z(){return(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-1",children:[(0,a.jsx)("div",{className:"w-1 h-1 bg-black rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-1 h-1 bg-black rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-1 h-1 bg-black rounded-full animate-bounce"})]})}var K=s(9150);function O(e){let t=q(l)[e.ulid]||"fail",s={size:"25"},n=(0,a.jsx)(a.Fragment,{}),o="";switch(t){case"statusCodeNotSame":n=(0,a.jsx)(K.SR5,{...s,color:"red"}),o="Status code doesn't match";break;case"bodyNotSame":n=(0,a.jsx)(K.KP3,{...s,color:"red"}),o="Response body doesn't match";break;case"headerNotSame":n=(0,a.jsx)(K.KP3,{...s,color:"orange"}),o="Headers don't match";break;case"waitingResponse":n=(0,a.jsx)(K.xz6,{...s,className:"animate-spin"});break;case"fail":n=(0,a.jsx)(K.SV5,{...s}),o="Request failed";break;case"success":n=(0,a.jsx)(K.KP3,{...s,color:"green"});break;case"waitingQueue":n=(0,a.jsx)(z,{...s});break;case"init":return(0,a.jsx)(a.Fragment,{})}return(0,a.jsxs)("div",{className:"relative inline-flex align-middle text-center",children:[n,o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"opacity-0 pointer-events-none absolute z-10 bg-black text-white text-xs py-1 px-2 rounded whitespace-nowrap top-full -left-1/2 transform -translate-x-1/2 transition-opacity duration-300",children:o}),(0,a.jsx)("style",{children:"\n          .relative:hover .absolute {\n            opacity: 1;\n          }\n          "})]})]})}function Q(e){let{handleCheckboxClick:t,isSelected:s,ulid:n}=e,o=q(N(n)),r=L(o.Ulid),l=T();return(0,a.jsxs)("tr",{className:"border-b hover:bg-gray-100",onClick:()=>{l(B(n))},children:[(0,a.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",onClick:e=>t(e),children:(0,a.jsx)("div",{className:"w-3 h-3 border  rounded m-auto block ".concat(s?"bg-blue-500 border-blue-500":" border-gray-500")})}),(0,a.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:o.Method}),(0,a.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:o.Url}),(0,a.jsx)("td",{className:"px-4 whitespace-nowrap overflow-hidden max-w-0",children:o.IsReqText?(0,a.jsx)("code",{className:"bg-gray-700 text-white p-1 text-xs",children:o.ReqBody}):(0,a.jsx)(A,{ulid:n,type:"req-body",contentLength:o.ReqHeader["Content-Length"]})}),(0,a.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:o.StatusCode.toString()}),(0,a.jsx)("td",{className:"px-4 py-2 whitespace-nowrap overflow-hidden max-w-0",children:o.IsResText?(0,a.jsx)("code",{className:"bg-gray-700 text-white p-1 text-xs",children:o.ResBody}):(0,a.jsx)(A,{ulid:n,type:"res-body",contentLength:o.ResHeader["Content-Length"]})}),(0,a.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-center",children:(0,a.jsx)(O,{ulid:o.Ulid})}),(0,a.jsx)("td",{className:"px-4 whitespace-nowrap",children:(0,a.jsx)("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-2 rounded-full flex items-center m-auto",onClick:e=>{e.stopPropagation(),r()},children:(0,a.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l8 8-8 8"})})})})]})}var V=s(2265);function D(){let e=T(),t=q(k),[s,n]=(0,V.useState)([]),[o,r]=(0,V.useState)(-1),i=function(){let e=T();return t=>{e(async(e,s)=>{let a={...l(s())};for(let e of t)"waitingResponse"!==a[e]&&(a[e]="waitingQueue");for(let n of(e(d(a)),t)){let t=c(n)(s());"waitingQueue"===t&&await e(b(n))}})}}(),u=s.every(e=>e)&&s.length>0,x=(e,t)=>{if(!s.length)return;let a=[...s];if(e.shiftKey){let e=!s[t];for(let s=Math.min(o,t);s<=Math.max(o,t);s++)a[s]=e}else a[t]=!s[t];n(a),r(t),e.preventDefault(),e.stopPropagation()},p=async()=>{let t=await fetch("".concat("/","all"),{}),s=await t.json();e(v(s));let a={};for(let e of s)a[e.Ulid]="init";e(d(a)),n(Array(s.length).fill(!0))};return(0,V.useEffect)(()=>{p()},[]),(0,a.jsxs)("div",{className:"flex flex-col justify-center items-center",children:[(0,a.jsxs)("div",{className:"flex w-full justify-between px-4 py-3 mb-2",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Isucon Middleware"}),(0,a.jsx)("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded-full flex items-center",onClick:e=>{let a=t.filter((e,t)=>s[t]);i(a),e.stopPropagation()},children:"Execute Checked"})]}),(0,a.jsxs)("table",{className:"table-auto border-collapse w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b bg-gray-100 text-gray-600",children:[(0,a.jsx)("th",{className:"px-4 py-2 whitespace-nowrap",onClick:()=>{n(Array(s.length).fill(!u))},children:(0,a.jsx)("div",{className:"w-4 h-4 border border-gray-500 rounded m-auto block ".concat(u?"bg-blue-500":"bg-white")})}),(0,a.jsx)("th",{className:"px-4 py-2 whitespace-nowrap",children:"Method"}),(0,a.jsx)("th",{className:"px-4 py-2 whitespace-nowrap",children:"URL"}),(0,a.jsx)("th",{className:"px-4 py-2 w-1/2",children:"ReqBody"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Status Code"}),(0,a.jsx)("th",{className:"px-4 py-2 w-1/2",children:"ResBody"}),(0,a.jsx)("th",{children:"Execution Result"}),(0,a.jsx)("th",{className:"px-4 py-2 w-1/2",children:"Execute"})]})}),(0,a.jsx)("tbody",{children:t.map((e,t)=>(0,a.jsx)(Q,{isSelected:s[t],handleCheckboxClick:e=>x(e,t),ulid:e},e))})]})]})}function G(){return(0,a.jsxs)(f.zt,{store:M,children:[(0,a.jsx)(D,{}),(0,a.jsx)(U,{})]})}}},function(e){e.O(0,[712,876,971,472,744],function(){return e(e.s=245)}),_N_E=e.O()}]);